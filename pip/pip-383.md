# PIP-383: Support granting/revoking permissions for multiple topics

## Background

In AuthorizationProvider, the authorization interface `grantPermissionAsync(TopicName topicName, Set<AuthAction> actions, String role, String authDataJson)` currently only supports granting permissions to a single topic. 
If multiple topics need to be authorized under a namespace, the client needs to call the authorization interface concurrently. 
Since the permissions information are stored in the namespace-level policies, and multiple topics may be on different brokers, concurrent authorization will cause concurrent modification exceptions. 
Therefore, supporting granting permissions for multiple topics is very friendly.


## Motivation

Supporting granting/revoking permissions for multiple topics, 
add `grantPermissionAsync(List<GrantPermissionOptions> options)` and `revokePermissionAsync(List<RevokePermissionOptions> options)` in AuthorizationProvider.

## Goals

### In Scope

- Add `grantPermissionAsync(List<GrantPermissionOptions> options)` in AuthorizationProvider.
- Add `revokePermissionAsync(List<RevokePermissionOptions> options)` in AuthorizationProvider.

## High-Level Design

### Design & Implementation Details

```java

public interface AuthorizationProvider extends Closeable {

    CompletableFuture<Void> grantPermissionAsync(List<GrantPermissionOptions> options);

    CompletableFuture<Void> revokePermissionAsync(List<RevokePermissionOptions> options);
}
```

```
@Data
@Builder
public class GrantPermissionOptions {

    private final String topic;
    
    private final String role;

    private final Set<AuthAction> actions;
}

@Data
@Builder
public class RevokePermissionOptions {

    private final String topic;

    private final String role;
}
```

Support this in the namespace admin API.

```java
public interface Namespaces {
    
    CompletableFuture<Void> grantPermissionAsync(List<GrantPermissionOptions> options);

    void grantPermission(List<GrantPermissionOptions> options) throws PulsarAdminException;

    CompletableFuture<Void> revokePermissionAsync(List<RevokePermissionOptions> options);

    void revokePermission(List<RevokePermissionOptions> options) throws PulsarAdminException;
}
```

so user can grant/revoke permissions to multi-topics like :
```java
// grant permission for multi-topics
List<GrantPermissionOptions> grantPermissions = new ArrayList<>();
grantPermissions.add(GrantPermissionOptions.builder().topic("topic1").role("role1").actions(Set.of(AuthAction.produce)).build());
grantPermissions.add(GrantPermissionOptions.builder().topic("topic2").role("role2").actions(Set.of(AuthAction.consume)).build());
admin.namespaces().grantPermission(grantPermissions);
// revoke permission topics
List<GrantPermissionOptions> revokePermissions = new ArrayList<>();
revokePermissions.add(RevokePermissionOptions.builder().topic("topic1").role("role1")).build());
revokePermissions.add(RevokePermissionOptions.builder().topic("topic2").role("role2")).build());
admin.namespaces().revokePermission(revokePermissions);

```

## Backward & Forward Compatibility



## Alternatives

## General Notes

## Links

* Mailing List discussion thread: 
* Mailing List voting thread: 
